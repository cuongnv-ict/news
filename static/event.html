<!doctype html>
<html lang="en">

<head>
    <title>Event Detection Service</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">

    <!--
        <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    -->

    <link rel="stylesheet" href="custom/custom.css">

</head>

<body>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>

    <!--
<script src="bootstrap/js/bootstrap.min.js"></script>
-->

    <div class="container">
        <div class="row">

        </div>
        <div class="row">
            <div class="col-12">
                <h3 class="text-center">Event Detection Service</h3>
                <h4 class="text-center">&copy; ML-BKA</h4>
                <h5 class="text-center">Version 1.0</h5>
            </div>
        </div>
        <!-- Content here -->
        <div class="row">
            <div class="col-12">
            <hr>
            </div>
        </div>
        <div class="row">
            <div class="col-6" id="eventContainer">

                <div id="eventList">
                    <div>
                        <div id="accordion">

                        </div>
                    </div>
                </div>


            </div>

            <div class="col-6" id="newsContent">


            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <br>
                <br>
              <img src="documents_distribution.png" class="img-rounded" style="height: 100%;" alt="Topics distribution">
            </div>
        </div>
    </div>
    <script type='text/javascript'>

        String.prototype.format = function () {
            var content = this;
            for (var i = 0; i < arguments.length; i++) {
                var replacement = '{' + i + '}';
                content = content.replace(replacement, arguments[i]);
            }
            return content;
        };

        update();

        function toUpperTitle(title){
            firstLetter = title[0].toUpperCase();
            title = firstLetter + title.substring(1);
            return title;
        }

        function update() {
            clearAll();
            var url = "/update"
            var posting = $.post(url);
            //console.log("update: ")
            /* Alerts the results */
            posting.done(function (data) {
                //alert('success');
                if (data["error"] != undefined) {
                    $("#recProductsByCourse").val(data["msg"])
                    return;
                }
                //
                //console.log(typeof(data));
                data = JSON.parse(data);
                //console.log(typeof(data));
                //console.log(data[0]['title']);

                try {
                    for (var i = 0; i < data.length; i++) {
                        //recs = recs + data[i]["id"] + " #N: "+data[i]["name"]+" #S: "+data[i]["score"].toFixed(1) + "\n"

                        card = createCard(data[i],i)
                        $("#accordion").append(card)
                    }
                }
                catch (e) {
                    recs = data
                }
            });

        }
        function getContent(title) {
            var url = "/get"
            var posting = $.post(url, { title: title });
            //console.log("Get: " + title)
            /* Alerts the results */
            posting.done(function (data) {
                //alert('success');
                if (data["error"] != undefined) {
                    $("#recProductsByCourse").val(data["msg"])
                    return;
                }


                $("#newsContent").html(data);
            });

        }

        function clearAll() {
            //console.log("Clear")
            $("#accordion").empty();
            $("#newsContent").empty();
        }
        function createCard(jsonCardData, idx) {

            //console.log('Create card');
            title = jsonCardData['title']
            upperTitle = toUpperTitle(title);

            subTitles = jsonCardData['subTitles']
            //console.log('Title: '+title);

            divTitle = ' <div class="card"> '
                + '<div class="card-header bg-light" id="heading{0}">'
                + '<h5 class="mb-0">'
                + '<button class="btn" data-toggle="collapse" data-target="#collapse{1}"' + 'aria-expanded="true" aria-controls="collapse{2}">'
                + upperTitle
                + '</button>'
                + '</h5>'
                + '</div>'

                + '<div id="collapse{3}" class="collapse" aria-labelledby="heading{4}" data-parent="#accordion">'
                + '<div class="card-body">'
                + '<ul class="list-group">'

            divTitle = divTitle.format(idx, idx, idx, idx, idx);


            for (i = 0; i < subTitles.length; ++i) {
                subItemTitle = subTitles[i]['title']
                upperTitle = toUpperTitle(subItemTitle);
                //console.log("Sub title: "+subItemTitle);
                li = '<li class="list-group-item">'
                    + '<a href="javascript:getContent(\'' + subItemTitle + '\')";>' + upperTitle + '</a>'
                    + '</li>'
                divTitle = divTitle + li
            }

            divFoot = '</ul> </div> </div> </div>';

            cardDiv = divTitle + divFoot;;
            //console.log(cardDiv);
            return cardDiv;



        }

        

    </script>
</body>

</html>