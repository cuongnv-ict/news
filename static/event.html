<!doctype html>
<html lang="en">

<head>
    <title>Event Detection Service</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">

    <!--
        <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    -->

    <link rel="stylesheet" href="custom/custom.css">
    <style>
        .newsContent{
            height:45em;
            overflow:auto;
        }
    </style>

     <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>

    <!--
<script src="bootstrap/js/bootstrap.min.js"></script>
-->
    <script>
        $(function() {
            var offset = $(".newsContent").offset();
            var topPadding = 15;
            $(window).scroll(function() {
                if ($(window).scrollTop() > offset.top) {
                    $(".newsContent").stop().animate({
                        marginTop: $(window).scrollTop() - offset.top + topPadding
                    });
                } else {
                    $(".newsContent").stop().animate({
                        marginTop: 0
                    });
                };
            });
        });

        $(document).on('click','.nav-link',function(){
            $('.newsContent').empty();
        })
    </script>
</head>

<body>
    <div class="container">

        <div id="header">
            <div class="row">

            </div>
            <div class="row">
                <div class="col-12">
                    <h3 class="text-center">English Event Detection Service</h3>
                    <h4 class="text-center">&copy; Dora Team</h4>
                    <h5 class="text-center">Version 0.1</h5>
                </div>
            </div>
            <!-- Content here -->
            <div class="row">
                <div class="col-12">
                    <hr>
                </div>
            </div>


            <div class="row">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="sport-tab" data-toggle="tab" href="#sport" role="tab" aria-controls="home"
                            aria-selected="true">Sport</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="general-tab" data-toggle="tab" href="#general" role="tab" aria-controls="general" aria-selected="false">General</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="entertainment-tab" data-toggle="tab" href="#entertainment" role="tab" aria-controls="entertainment" aria-selected="false">Entertainment</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="health-tab" data-toggle="tab" href="#health" role="tab" aria-controls="health" aria-selected="false">Health</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="business-tab" data-toggle="tab" href="#business" role="tab" aria-controls="business" aria-selected="false">Business</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="science-tab" data-toggle="tab" href="#science" role="tab" aria-controls="science" aria-selected="false">Science</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="technology-tab" data-toggle="tab" href="#technology" role="tab" aria-controls="technology" aria-selected="false">Technology</a>
                    </li>

                </ul>
            </div>
        </div>

        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="sport" role="tabpanel" aria-labelledby="sport-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-sport">

                        <div id="eventList-sport">
                            <div>
                                <div id="accordion-sport">

                                </div>
                            </div>
                        </div>


                    </div>

                    <div class="col-6 newsContent">


                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="general" role="tabpanel" aria-labelledby="general-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-general">
                        <div id="eventList-general">
                            <div>
                                <div id="accordion-general">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6 newsContent">
                    </div>

                </div>
            </div>


            <div class="tab-pane fade" id="entertainment" role="tabpanel" aria-labelledby="entertainment-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-entertainment">
                        <div id="eventList-entertainment">
                            <div>
                                <div id="accordion-entertainment">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6 newsContent">
                    </div>

                </div>

            </div>


            <div class="tab-pane fade" id="health" role="tabpanel" aria-labelledby="health-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-health">
                        <div id="eventList-health">
                            <div>
                                <div id="accordion-health">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6 newsContent">
                    </div>

                </div>

            </div>                   

            <div class="tab-pane fade" id="business" role="tabpanel" aria-labelledby="business-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-business">
                        <div id="eventList-business">
                            <div>
                                <div id="accordion-business">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6 newsContent">
                    </div>

                </div>
            </div>

            <div class="tab-pane fade" id="nha-dat" role="tabpanel" aria-labelledby="nha-dat-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-nha-dat">
                        <div id="eventList-nha-dat">
                            <div>
                                <div id="accordion-nha-dat">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6 newsContent">
                    </div>

                </div>
            </div>

            <div class="tab-pane fade" id="science" role="tabpanel" aria-labelledby="science-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-science">
                        <div id="eventList-science">
                            <div>
                                <div id="accordion-science">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6 newsContent">
                    </div>

                </div>
            </div>

            <div class="tab-pane fade" id="technology" role="tabpanel" aria-labelledby="technology-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-technology">
                        <div id="eventList-technology">
                            <div>
                                <div id="accordion-technology">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6 newsContent">
                    </div>

                </div>
            </div>

        </div>


    </div>
    <script type='text/javascript'>

        var TOPIC_IDS = ['sport', 'general', 'entertainment', 'health', 
                         'business', 'science', 'technology'];


        String.prototype.format = function () {
            var content = this;
            for (var i = 0; i < arguments.length; i++) {
                var replacement = '{' + i + '}';
                content = content.replace(replacement, arguments[i]);
            }
            return content;
        };

        update();

        function toUpperTitle(title) {
            firstLetter = title[0].toUpperCase();
            title = firstLetter + title.substring(1);
            return title;
        }
        function update() {
            console.log("In update function ...")
            clearAll();
            var url = "/update"
            var posting = $.post(url);
            //console.log("update: ")
            /* Alerts the results */
            posting.done(function (data) {
                //alert('success');
                if (data["error"] != undefined) {
                    $("#recProductsByCourse").val(data["msg"])
                    return;
                }
                //
                //console.log(typeof(data));
                //data = JSON.parse(data);
                //console.log(typeof(data));
                //console.log(data+ " "+data.length);
                //alert(data)

                try {
                    for (var tid = 0; tid < data.length; tid++) {
                        var data_t = data[tid]
                        var t_name = data_t['domain']
                        var t_id = data_t['id']
                        var t_content = data_t['content']
                        for (var i = 0; i < t_content.length; i++) {
                            //recs = recs + data[i]["id"] + " #N: "+data[i]["name"]+" #S: "+data[i]["score"].toFixed(1) + "\n"

                            card = createCard(t_content[i], i,t_id)
                            //console.log("t_content[i] = " + t_content[i])
                            $("#accordion-" + t_id).append(card)
                        }
                    }
                }
                catch (e) {
                    recs = data
                }
            });

        }
        function getContent(contentId) {
            console.log("In getContent function ...")
            var url = "/get"
            var posting = $.post(url, { contentId: contentId });
            //console.log("Get: " + title)
            /* Alerts the results */
            posting.done(function (data) {
                //alert('success');
                if (data["error"] != undefined) {
                    $("#recProductsByCourse").val(data["msg"])
                    return;
                }

                console.log(data)
                $(".newsContent").html(data);
            });

        }

        function clearAll() {

            //console.log("Clear")
            for (i = 0; i < TOPIC_IDS.length; ++i) {
                $("#accordion-" + TOPIC_IDS[i]).empty();
                $("#newsContent-" + TOPIC_IDS[i]).empty();
            }
        }
        function createCard(jsonCardData, idx,tid) {

            //console.log('Create card');
            title = jsonCardData['title']
            upperTitle = toUpperTitle(title);

            subTitles = jsonCardData['subTitles']
            //console.log('Title: '+title);

            divTitle = ' <div class="card"> '
                + '<div class="card-header bg-light" id="heading{0}">'
                + '<h5 class="mb-0">'
                + '<button style="white-space:normal" class="btn" data-toggle="collapse" data-target="#collapse{1}"' + 'aria-expanded="true" aria-controls="collapse{2}">'
                + upperTitle
                + '</button>'
                + '</h5>'
                + '</div>'

                + '<div id="collapse{3}" class="collapse" aria-labelledby="heading{4}" data-parent="#accordion-{5}">'
                + '<div class="card-body">'
                + '<ul class="list-group">'

            divTitle = divTitle.format("-"+tid+"-"+idx, "-"+tid+"-"+idx, "-"+tid+"-"+idx, "-"+tid+"-"+idx, "-"+tid+"-"+idx,tid);


            for (i = 0; i < subTitles.length; ++i) {
                subItemTitle = subTitles[i]['title']
                upperTitle = toUpperTitle(subItemTitle);
                contentId = subTitles[i]['contentId']
                //console.log("Sub title: "+subTitles[i]);
                li = '<li class="list-group-item">'
                    + '<a href="javascript:getContent(\'' + contentId + '\')";>' + upperTitle + '</a>'
                    + '</li>'
                divTitle = divTitle + li
            }

            divFoot = '</ul> </div> </div> </div>';

            cardDiv = divTitle + divFoot;;
            //console.log(cardDiv);
            return cardDiv;



        }
        //setInterval(update,300000);



    </script>
</body>

</html>