<!doctype html>
<html lang="en">

<head>
    <title>Event Detection Service</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">

    <!--
        <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    -->

    <link rel="stylesheet" href="custom/custom.css">

</head>

<body>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>

    <!--
<script src="bootstrap/js/bootstrap.min.js"></script>
-->

    <div class="container">


        <div class="row">

        </div>
        <div class="row">
            <div class="col-12">
                <h3 class="text-center">Event Detection Service</h3>
                <h4 class="text-center">&copy; ML-BKA</h4>
                <h5 class="text-center">Version 1.0</h5>
            </div>
        </div>
        <!-- Content here -->
        <div class="row">
            <div class="col-12">
                <hr>
            </div>
        </div>


        <div class="row">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="chinh-tri-tab" data-toggle="tab" href="#chinh-tri-xa-hoi" role="tab" aria-controls="home"
                        aria-selected="true">Chinh tri Xa hoi</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="doi-song-tab" data-toggle="tab" href="#doi-song" role="tab" aria-controls="doisong" aria-selected="false">Doi song</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="khoa-hoc-cong-nghe-tab" data-toggle="tab" href="#khoa-hoc-cong-nghe" role="tab" aria-controls="khoahoccongnghe" aria-selected="false">Khoa hoc Cong nghe</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="kinh-doanh-tab" data-toggle="tab" href="#kinh-doanh" role="tab" aria-controls="kinhdoanh" aria-selected="false">Kinh doanh</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="suc-khoe-tab" data-toggle="tab" href="#suc-khoe" role="tab" aria-controls="suckhoe" aria-selected="false">Suc khoe</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="the-gioi-tab" data-toggle="tab" href="#the-gioi" role="tab" aria-controls="thegioi" aria-selected="false">The gioi</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="the-thao-tab" data-toggle="tab" href="#the-thao" role="tab" aria-controls="thethao" aria-selected="false">The thao</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="van-hoa-tab" data-toggle="tab" href="#van-hoa" role="tab" aria-controls="vanhoa" aria-selected="false">Van hoa</a>
                </li>
                
            </ul>
        </div>



        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="chinh-tri-xa-hoi" role="tabpanel" aria-labelledby="chinh-tri-xa-hoi-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-chinh-tri-xa-hoi">

                        <div id="eventList-chinh-tri-xa-hoi">
                            <div>
                                <div id="accordion-chinh-tri-xa-hoi">

                                </div>
                            </div>
                        </div>


                    </div>

                    <div class="col-6" id="newsContent-chinh-tri-xa-hoi">


                    </div>
                </div>

                <br>
                <div class="row">
                    <div class="col-12">
                        <br>
                        <br>
                        <img src="chinh-tri-xa-hoi/documents_distribution.png" class="img-rounded" style="height: 100%;" alt="Topics distribution">
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="doi-song" role="tabpanel" aria-labelledby="doi-song-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-doi-song">
                        <div id="eventList-doi-song">
                            <div>
                                <div id="accordion-doi-song">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6" id="newsContent-doi-song">
                    </div>

                </div>

                <br>
                <div class="row">
                    <div class="col-12">
                        <br>
                        <br>
                        <img src="doi-song/documents_distribution.png" class="img-rounded" style="height: 100%;" alt="Topics distribution">
                    </div>
                </div>

            </div>


            <div class="tab-pane fade" id="khoa-hoc-cong-nghe" role="tabpanel" aria-labelledby="khoa-hoc-cong-nghe-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-khoa-hoc-cong-nghe">
                        <div id="eventList-khoa-hoc-cong-nghe">
                            <div>
                                <div id="accordion-khoa-hoc-cong-nghe">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6" id="newsContent-khoa-hoc-cong-nghe">
                    </div>

                </div>

                <br>
                <div class="row">
                    <div class="col-12">
                        <br>
                        <br>
                        <img src="khoa-hoc-cong-nghe/documents_distribution.png" class="img-rounded" style="height: 100%;" alt="Topics distribution">
                    </div>
                </div>

            </div>


            <div class="tab-pane fade" id="kinh-doanh" role="tabpanel" aria-labelledby="kinh-doanh-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-kinh-doanh">
                        <div id="eventList-khoa-hoc-cong-nghe">
                            <div>
                                <div id="accordion-kinh-doanh">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6" id="newsContent-kinh-doanh">
                    </div>

                </div>

                <br>
                <div class="row">
                    <div class="col-12">
                        <br>
                        <br>
                        <img src="kinh-doanh/documents_distribution.png" class="img-rounded" style="height: 100%;" alt="Topics distribution">
                    </div>
                </div>

            </div>




            <div class="tab-pane fade" id="suc-khoe" role="tabpanel" aria-labelledby="suc-khoe-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-suc-khoe">
                        <div id="eventList-suc-khoe">
                            <div>
                                <div id="accordion-suc-khoe">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6" id="newsContent-suc-khoe">
                    </div>

                </div>

                <br>
                <div class="row">
                    <div class="col-12">
                        <br>
                        <br>
                        <img src="suc-khoe/documents_distribution.png" class="img-rounded" style="height: 100%;" alt="Topics distribution">
                    </div>
                </div>

            </div>


            <div class="tab-pane fade" id="the-gioi" role="tabpanel" aria-labelledby="the-gioi-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-the-gioi">
                        <div id="eventList-the-gioi">
                            <div>
                                <div id="accordion-the-gioi">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6" id="newsContent-the-gioi">
                    </div>

                </div>

                <br>
                <div class="row">
                    <div class="col-12">
                        <br>
                        <br>
                        <img src="the-gioi/documents_distribution.png" class="img-rounded" style="height: 100%;" alt="Topics distribution">
                    </div>
                </div>

            </div>



            <div class="tab-pane fade" id="the-thao" role="tabpanel" aria-labelledby="the-thao-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-the-thao">
                        <div id="eventList-the-thao">
                            <div>
                                <div id="accordion-the-thao">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6" id="newsContent-the-thao">
                    </div>

                </div>

                <br>
                <div class="row">
                    <div class="col-12">
                        <br>
                        <br>
                        <img src="the-thao/documents_distribution.png" class="img-rounded" style="height: 100%;" alt="Topics distribution">
                    </div>
                </div>

            </div>


            <div class="tab-pane fade" id="van-hoa" role="tabpanel" aria-labelledby="van-hoa-tab">
                <div class="row">
                    <div class="col-6" id="eventContainer-van-hoa">
                        <div id="eventList-van-hoa">
                            <div>
                                <div id="accordion-van-hoa">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6" id="newsContent-van-hoa">
                    </div>

                </div>

                <br>
                <div class="row">
                    <div class="col-12">
                        <br>
                        <br>
                        <img src="van-hoa/documents_distribution.png" class="img-rounded" style="height: 100%;" alt="Topics distribution">
                    </div>
                </div>

            </div>


            
        </div>


    </div>
    <script type='text/javascript'>

        var TOPIC_IDS = ['chinh-tri-xa-hoi', 'doi-song', 'khoa-hoc-cong-nghe', 'kinh-doanh', 'suc-khoe', 'the-gioi', 'the-thao', 'van-hoa'];


        String.prototype.format = function () {
            var content = this;
            for (var i = 0; i < arguments.length; i++) {
                var replacement = '{' + i + '}';
                content = content.replace(replacement, arguments[i]);
            }
            return content;
        };

        update();

        function toUpperTitle(title) {
            firstLetter = title[0].toUpperCase();
            title = firstLetter + title.substring(1);
            return title;
        }
        function update() {
            console.log("In update")
            clearAll();
            var url = "/update"
            var posting = $.post(url);
            //console.log("update: ")
            /* Alerts the results */
            posting.done(function (data) {
                //alert('success');
                if (data["error"] != undefined) {
                    $("#recProductsByCourse").val(data["msg"])
                    return;
                }
                //
                console.log(typeof(data));
                //data = JSON.parse(data);
                //console.log(typeof(data));
                console.log(data+ " "+data.length);
                //alert(data)

                try {
                    for (var tid = 0; tid < data.length; tid++) {
                        var data_t = data[tid]
                        var t_name = data_t['domain']
                        var t_id = data_t['id']
                        var t_content = data_t['content']
                        console.log(data_t)
                        if (t_id=='the-thao'){
                            console.log('At the thao')
                            console.log(t_content)
                        }
                        for (var i = 0; i < t_content.length; i++) {
                            //recs = recs + data[i]["id"] + " #N: "+data[i]["name"]+" #S: "+data[i]["score"].toFixed(1) + "\n"

                            card = createCard(t_content[i], i,t_id)
                            $("#accordion-" + t_id).append(card)
                        }
                    }
                }
                catch (e) {
                    recs = data
                }
            });

        }
        function getContent(title) {
            var url = "/get"
            var posting = $.post(url, { title: title });
            //console.log("Get: " + title)
            /* Alerts the results */
            posting.done(function (data) {
                //alert('success');
                if (data["error"] != undefined) {
                    $("#recProductsByCourse").val(data["msg"])
                    return;
                }


                $("#newsContent").html(data);
            });

        }

        function clearAll() {

            //console.log("Clear")
            for (i = 0; i < TOPIC_IDS.length; ++i) {
                $("#accordion-" + TOPIC_IDS[i]).empty();
                $("#newsContent-" + TOPIC_IDS[i]).empty();
            }
        }
        function createCard(jsonCardData, idx,tid) {

            //console.log('Create card');
            title = jsonCardData['title']
            upperTitle = toUpperTitle(title);

            subTitles = jsonCardData['subTitles']
            //console.log('Title: '+title);

            divTitle = ' <div class="card"> '
                + '<div class="card-header bg-light" id="heading{0}">'
                + '<h5 class="mb-0">'
                + '<button class="btn" data-toggle="collapse" data-target="#collapse{1}"' + 'aria-expanded="true" aria-controls="collapse{2}">'
                + upperTitle
                + '</button>'
                + '</h5>'
                + '</div>'

                + '<div id="collapse{3}" class="collapse" aria-labelledby="heading{4}" data-parent="#accordion-{5}">'
                + '<div class="card-body">'
                + '<ul class="list-group">'

            divTitle = divTitle.format("-"+tid+"-"+idx, "-"+tid+"-"+idx, "-"+tid+"-"+idx, "-"+tid+"-"+idx, "-"+tid+"-"+idx,tid);


            for (i = 0; i < subTitles.length; ++i) {
                subItemTitle = subTitles[i]['title']
                upperTitle = toUpperTitle(subItemTitle);
                //console.log("Sub title: "+subItemTitle);
                li = '<li class="list-group-item">'
                    + '<a href="javascript:getContent(\'' + subItemTitle + '\')";>' + upperTitle + '</a>'
                    + '</li>'
                divTitle = divTitle + li
            }

            divFoot = '</ul> </div> </div> </div>';

            cardDiv = divTitle + divFoot;;
            //console.log(cardDiv);
            return cardDiv;



        }
        //setInterval(update,300000);



    </script>
</body>

</html>